<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#6B21A8">
    <title>üé≠ Carnaval Bingo 2026 üáßüá∑</title>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --purple-deep: #6B21A8;
            --purple-vibrant: #9333EA;
            --pink-hot: #EC4899;
            --yellow-carnival: #FACC15;
            --green-brazil: #22C55E;
            --blue-sky: #0EA5E9;
            --orange-fire: #F97316;
            --red-passion: #EF4444;
            --white: #FFFFFF;
            --dark: #1F1235;
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, var(--purple-deep) 0%, var(--pink-hot) 50%, var(--orange-fire) 100%);
            min-height: 100vh;
            color: var(--white);
            position: relative;
        }

        /* Animated background decorations */
        .bg-decorations {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }

        .floating-emoji {
            position: absolute;
            font-size: 2rem;
            opacity: 0.3;
            animation: float 20s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(10deg); }
            50% { transform: translateY(0) rotate(0deg); }
            75% { transform: translateY(20px) rotate(-10deg); }
        }

        /* Confetti animation */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confetti-fall 3s ease-out forwards;
        }

        @keyframes confetti-fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* Main container */
        .container {
            position: relative;
            z-index: 1;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 100px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 20px 0;
        }

        .logo {
            font-family: 'Fredoka', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 3px 3px 0 var(--dark),
                         -1px -1px 0 var(--yellow-carnival),
                         1px -1px 0 var(--yellow-carnival),
                         -1px 1px 0 var(--yellow-carnival);
            margin-bottom: 5px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .flag-emoji {
            font-size: 1.5rem;
        }

        /* Login Screen */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px 30px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .login-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .login-subtitle {
            opacity: 0.8;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }

        .login-emoji-row {
            font-size: 3rem;
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .login-emoji-row span {
            animation: wiggle 1s infinite;
        }

        .login-emoji-row span:nth-child(2) { animation-delay: 0.1s; }
        .login-emoji-row span:nth-child(3) { animation-delay: 0.2s; }
        .login-emoji-row span:nth-child(4) { animation-delay: 0.3s; }
        .login-emoji-row span:nth-child(5) { animation-delay: 0.4s; }

        @keyframes wiggle {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group input {
            width: 100%;
            padding: 18px 20px;
            font-size: 1.1rem;
            border: none;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.95);
            color: var(--dark);
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            text-align: center;
            outline: none;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.3);
        }

        .input-group input::placeholder {
            color: #999;
            font-weight: 400;
        }

        .btn {
            width: 100%;
            padding: 18px 30px;
            font-size: 1.2rem;
            font-weight: 700;
            font-family: 'Fredoka', sans-serif;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--yellow-carnival) 0%, var(--orange-fire) 100%);
            color: var(--dark);
            box-shadow: 0 8px 30px rgba(249, 115, 22, 0.4);
        }

        .btn-primary:hover, .btn-primary:active {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(249, 115, 22, 0.5);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Player info bar */
        .player-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 15px 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .player-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--yellow-carnival), var(--orange-fire));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .player-name {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .player-score {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .sync-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--green-brazil);
            animation: pulse 2s infinite;
        }

        .sync-dot.offline {
            background: var(--red-passion);
            animation: none;
        }

        .sync-dot.syncing {
            background: var(--yellow-carnival);
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Progress bar */
        .progress-container {
            margin-bottom: 20px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .progress-title {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .progress-count {
            font-weight: 700;
            font-size: 1rem;
            color: var(--yellow-carnival);
        }

        .progress-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--green-brazil), var(--yellow-carnival));
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Tab navigation */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 14px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 14px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab.active {
            background: rgba(255, 255, 255, 0.25);
            border-color: var(--yellow-carnival);
            box-shadow: 0 4px 20px rgba(250, 204, 21, 0.3);
        }

        .tab:not(.active):hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Bingo Grid */
        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .bingo-cell {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .bingo-cell:hover {
            transform: scale(1.05);
        }

        .bingo-cell:active {
            transform: scale(0.95);
        }

        .bingo-cell.completed {
            background: linear-gradient(135deg, var(--green-brazil), #16A34A);
            box-shadow: 0 4px 20px rgba(34, 197, 94, 0.4);
        }

        .bingo-cell.completed .cell-text {
            color: var(--white);
        }

        .bingo-cell.completed::after {
            content: '‚úì';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.9rem;
            color: var(--white);
            font-weight: bold;
        }

        .cell-text {
            font-size: 0.55rem;
            font-weight: 600;
            color: var(--dark);
            text-align: center;
            line-height: 1.2;
            word-break: break-word;
            hyphens: auto;
        }

        @media (min-width: 400px) {
            .cell-text {
                font-size: 0.65rem;
            }
        }

        /* Cell detail modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: linear-gradient(135deg, var(--purple-deep), var(--pink-hot));
            border-radius: 24px;
            padding: 30px;
            max-width: 350px;
            width: 100%;
            text-align: center;
            animation: modalPop 0.3s ease;
            border: 3px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
        }

        @keyframes modalPop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .modal-emoji {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .modal-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.4rem;
            margin-bottom: 20px;
            line-height: 1.3;
        }

        .modal-status {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 30px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 25px;
        }

        .modal-status.pending {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-status.done {
            background: var(--green-brazil);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
        }

        .modal-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 14px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn-cancel {
            background: rgba(255, 255, 255, 0.2);
            color: var(--white);
        }

        .modal-btn-confirm {
            background: var(--green-brazil);
            color: var(--white);
        }

        .modal-btn-undo {
            background: var(--red-passion);
            color: var(--white);
        }

        .modal-btn:hover {
            transform: translateY(-2px);
        }

        /* Leaderboard */
        .leaderboard {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .leaderboard-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.3rem;
            text-align: center;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 14px;
            transition: all 0.3s ease;
        }

        .leaderboard-item.current-user {
            background: rgba(250, 204, 21, 0.2);
            border: 2px solid var(--yellow-carnival);
        }

        .leaderboard-item.top-1 {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 165, 0, 0.2));
            border: 2px solid gold;
        }

        .leaderboard-item.top-2 {
            background: linear-gradient(135deg, rgba(192, 192, 192, 0.3), rgba(169, 169, 169, 0.2));
            border: 2px solid silver;
        }

        .leaderboard-item.top-3 {
            background: linear-gradient(135deg, rgba(205, 127, 50, 0.3), rgba(184, 115, 51, 0.2));
            border: 2px solid #CD7F32;
        }

        .leaderboard-rank {
            width: 35px;
            height: 35px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1rem;
        }

        .leaderboard-item.top-1 .leaderboard-rank { background: gold; color: var(--dark); }
        .leaderboard-item.top-2 .leaderboard-rank { background: silver; color: var(--dark); }
        .leaderboard-item.top-3 .leaderboard-rank { background: #CD7F32; color: var(--white); }

        .leaderboard-player {
            flex: 1;
        }

        .leaderboard-player-name {
            font-weight: 700;
            font-size: 1rem;
        }

        .leaderboard-player-progress {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .leaderboard-score {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--yellow-carnival);
        }

        .leaderboard-empty {
            text-align: center;
            padding: 40px;
            opacity: 0.7;
        }

        .leaderboard-empty-emoji {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        /* Bingo celebration */
        .bingo-celebration {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .bingo-celebration.active {
            display: flex;
        }

        .bingo-text {
            font-family: 'Fredoka', sans-serif;
            font-size: 5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--yellow-carnival), var(--orange-fire), var(--pink-hot), var(--purple-vibrant));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: bingoScale 0.5s ease infinite alternate;
            text-shadow: none;
        }

        @keyframes bingoScale {
            0% { transform: scale(1) rotate(-2deg); }
            100% { transform: scale(1.1) rotate(2deg); }
        }

        .bingo-subtext {
            font-size: 1.5rem;
            margin-top: 20px;
            opacity: 0.9;
        }

        .bingo-close {
            margin-top: 40px;
            padding: 15px 40px;
            background: var(--yellow-carnival);
            color: var(--dark);
            border: none;
            border-radius: 30px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 150;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            background: rgba(0, 0, 0, 0.9);
            color: var(--white);
            padding: 15px 25px;
            border-radius: 30px;
            font-weight: 600;
            animation: toastIn 0.3s ease, toastOut 0.3s ease 2.7s forwards;
            white-space: nowrap;
        }

        .toast.success {
            background: var(--green-brazil);
        }

        .toast.error {
            background: var(--red-passion);
        }

        @keyframes toastIn {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        @keyframes toastOut {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* Loading spinner */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top-color: var(--yellow-carnival);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            font-weight: 600;
            opacity: 0.8;
        }

        /* Offline banner */
        .offline-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--red-passion);
            color: var(--white);
            text-align: center;
            padding: 10px;
            font-weight: 600;
            font-size: 0.9rem;
            z-index: 300;
            display: none;
        }

        .offline-banner.active {
            display: block;
        }

        /* Decorative stickers */
        .sticker {
            position: absolute;
            font-size: 2rem;
            pointer-events: none;
            opacity: 0.15;
        }

        /* Brazilian meme text stickers */
        .meme-sticker {
            position: absolute;
            font-family: 'Fredoka', sans-serif;
            font-weight: 700;
            padding: 8px 16px;
            border-radius: 20px;
            opacity: 0.2;
            transform: rotate(var(--rotation, 0deg));
            white-space: nowrap;
            pointer-events: none;
            animation: float 25s infinite ease-in-out;
        }

        .meme-sticker.yellow { background: var(--yellow-carnival); color: var(--dark); }
        .meme-sticker.green { background: var(--green-brazil); color: white; }
        .meme-sticker.pink { background: var(--pink-hot); color: white; }
        .meme-sticker.blue { background: var(--blue-sky); color: white; }

        /* Responsive adjustments */
        @media (max-width: 360px) {
            .container {
                padding: 15px;
            }

            .bingo-grid {
                gap: 5px;
            }

            .cell-text {
                font-size: 0.5rem;
            }

            .logo {
                font-size: 2rem;
            }
        }

        /* Ensure nothing breaks on notch phones */
        @supports (padding-top: env(safe-area-inset-top)) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
    </style>
</head>
<body>
    <!-- Offline Banner -->
    <div class="offline-banner" id="offlineBanner">
        üì° You're offline - changes will sync when connected
    </div>

    <!-- Background decorations -->
    <div class="bg-decorations" id="bgDecorations"></div>

    <!-- Confetti container -->
    <div class="confetti-container" id="confettiContainer"></div>

    <!-- Toast notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="logo">üé≠ CARNAVAL BINGO</h1>
            <p class="subtitle">
                <span class="flag-emoji">üáßüá∑</span>
                Salvador ‚Ä¢ Morro ‚Ä¢ Rio 2026
                <span class="flag-emoji">üáßüá∑</span>
            </p>
        </header>

        <!-- Login Screen -->
        <div class="screen active" id="loginScreen">
            <div class="login-card">
                <div class="login-emoji-row">
                    <span>üáßüá∑</span>
                    <span>üíÉ</span>
                    <span>üé≠</span>
                    <span>üçπ</span>
                    <span>üáßüá∑</span>
                </div>
                <h2 class="login-title">BORA PRO CARNAVAL!</h2>
                <p class="login-subtitle">Enter your name to get your unique bingo card, meu parceiro</p>
                <div class="input-group">
                    <input type="text" id="playerNameInput" placeholder="Your name..." maxlength="20" autocomplete="off">
                </div>
                <button class="btn btn-primary" id="joinBtn" disabled>
                    üáßüá∑ BORA! Let's Go!
                </button>
            </div>
        </div>

        <!-- Main Game Screen -->
        <div class="screen" id="gameScreen">
            <!-- Player Bar -->
            <div class="player-bar">
                <div class="player-info">
                    <div class="player-avatar" id="playerAvatar">üé≠</div>
                    <div>
                        <div class="player-name" id="playerDisplayName">Player</div>
                        <div class="player-score" id="playerScoreText">0/25 completed</div>
                    </div>
                </div>
                <div class="sync-status">
                    <div class="sync-dot" id="syncDot"></div>
                    <span id="syncText">Synced</span>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-header">
                    <span class="progress-title">Your Progress</span>
                    <span class="progress-count" id="progressCount">0/25</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" data-tab="bingo">
                    üéØ My Card
                </button>
                <button class="tab" data-tab="leaderboard">
                    üèÜ Leaderboard
                </button>
            </div>

            <!-- Bingo Tab -->
            <div class="tab-content active" id="bingoTab">
                <div class="bingo-grid" id="bingoGrid">
                    <!-- Cells will be generated by JS -->
                </div>
            </div>

            <!-- Leaderboard Tab -->
            <div class="tab-content" id="leaderboardTab" style="display: none;">
                <div class="leaderboard">
                    <h3 class="leaderboard-title">üèÜ Leaderboard üèÜ</h3>
                    <div class="leaderboard-list" id="leaderboardList">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p class="loading-text">Loading leaderboard...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cell Detail Modal -->
    <div class="modal-overlay" id="cellModal">
        <div class="modal">
            <div class="modal-emoji" id="modalEmoji">üé≠</div>
            <h3 class="modal-title" id="modalTitle">Challenge Title</h3>
            <div class="modal-status pending" id="modalStatus">Not completed yet</div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" id="modalCancel">Cancel</button>
                <button class="modal-btn modal-btn-confirm" id="modalConfirm">Mark Done! ‚úì</button>
            </div>
        </div>
    </div>

    <!-- Bingo Celebration -->
    <div class="bingo-celebration" id="bingoCelebration">
        <div class="bingo-text">üáßüá∑ BINGO! üáßüá∑</div>
        <p class="bingo-subtext">CARACA! You completed all 25 squares!</p>
        <p class="bingo-subtext" style="font-size: 1rem; margin-top: 10px;">Voc√™ √© o cara! üëë</p>
        <button class="bingo-close" id="bingoClose">VAMOOO! üçπ</button>
    </div>

    <script>
        // ===========================================
        // CARNIVAL BINGO - MAIN APPLICATION
        // ===========================================

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAEkfjCoGRDqY-hU3DHZVNh3qjcAX7JJ1U",
            authDomain: "carnaval-2026-b9f14.firebaseapp.com",
            projectId: "carnaval-2026-b9f14",
            storageBucket: "carnaval-2026-b9f14.firebasestorage.app",
            messagingSenderId: "310835869777",
            appId: "1:310835869777:web:f7cfa672ec9d3668cc6070"
        };

        // ===========================================
        // BINGO SQUARES DATA
        // ===========================================

        const FIXED_SQUARES = [
            { text: "Made out with 2+ people in one night", emoji: "üíã" },
            { text: "Ate street food after 3am", emoji: "üåÆ" },
            { text: "Witnessed people having sex on the street", emoji: "üëÄ" },
            { text: "Took drugs", emoji: "üíä" },
            { text: "Puked", emoji: "ü§Æ" },
            { text: "Lost your phone (even temporarily)", emoji: "üì±" },
            { text: "Swam in the ocean at sunrise", emoji: "üåÖ" },
            { text: "Got invited to an after-party", emoji: "üéâ" },
            { text: "Stayed out until the sun came up", emoji: "‚òÄÔ∏è" },
            { text: "Danced with someone 2x your age or half your age", emoji: "üíÉ" },
            { text: "Got a temporary tattoo or henna", emoji: "üé®" },
            { text: "Danced on top of something", emoji: "üï∫" },
            { text: "Shared food with a complete stranger", emoji: "üçï" },
            { text: "Met a stranger from your home country", emoji: "üåç" },
            { text: "Skinny dipped", emoji: "üèä" },
            { text: "Convinced a stranger you're Brazilian", emoji: "üáßüá∑" },
            { text: "Made Seika proud", emoji: "üëë" },
            { text: "Rode on someone's shoulders", emoji: "üôå" },
            { text: "Lost your voice from screaming/singing", emoji: "üé§" },
            { text: "Got food poisoning or other illness", emoji: "ü§¢" },
            { text: "Got wacked by the police", emoji: "üëÆ" }
        ];

        const POOL_SQUARES = [
            { text: "Taught a stranger a dance move", emoji: "ü™©" },
            { text: "Fell asleep in an Uber", emoji: "üò¥" },
            { text: "Started a chant or sing-along", emoji: "üì£" },
            { text: "Spilled a drink on yourself", emoji: "üç∫" },
            { text: "Got a ridiculous sunburn or tan line", emoji: "üî•" },
            { text: "Lost or broke sunglasses", emoji: "üòé" },
            { text: "Found money on the ground", emoji: "üí∞" },
            { text: "Exchanged clothing items with a stranger", emoji: "üëï" }
        ];

        // ===========================================
        // APPLICATION STATE
        // ===========================================

        let db = null;
        let currentPlayer = null;
        let playerCard = [];
        let completedSquares = new Set();
        let isOnline = navigator.onLine;
        let pendingSyncs = [];
        let selectedCellIndex = null;
        let leaderboardUnsubscribe = null;

        // ===========================================
        // UTILITY FUNCTIONS
        // ===========================================

        // Seeded random number generator for consistent card generation
        function seededRandom(seed) {
            const x = Math.sin(seed) * 10000;
            return x - Math.floor(x);
        }

        // Generate a unique card based on player name
        function generateCard(playerName) {
            // Create seed from player name
            let seed = 0;
            for (let i = 0; i < playerName.length; i++) {
                seed += playerName.charCodeAt(i) * (i + 1);
            }

            // Start with all fixed squares
            const card = [...FIXED_SQUARES];

            // Shuffle pool and pick 4
            const shuffledPool = [...POOL_SQUARES];
            for (let i = shuffledPool.length - 1; i > 0; i--) {
                seed++;
                const j = Math.floor(seededRandom(seed) * (i + 1));
                [shuffledPool[i], shuffledPool[j]] = [shuffledPool[j], shuffledPool[i]];
            }

            // Add 4 random from pool
            card.push(...shuffledPool.slice(0, 4));

            // Shuffle the entire card
            for (let i = card.length - 1; i > 0; i--) {
                seed++;
                const j = Math.floor(seededRandom(seed) * (i + 1));
                [card[i], card[j]] = [card[j], card[i]];
            }

            return card;
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Local storage helpers
        function saveToLocalStorage() {
            const data = {
                playerName: currentPlayer,
                completedSquares: Array.from(completedSquares),
                lastUpdated: Date.now()
            };
            localStorage.setItem('carnavalBingo', JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            try {
                const data = JSON.parse(localStorage.getItem('carnavalBingo'));
                return data;
            } catch (e) {
                return null;
            }
        }

        // Update sync status indicator
        function updateSyncStatus(status) {
            const dot = document.getElementById('syncDot');
            const text = document.getElementById('syncText');

            dot.className = 'sync-dot';

            switch(status) {
                case 'synced':
                    text.textContent = 'Synced';
                    break;
                case 'syncing':
                    dot.classList.add('syncing');
                    text.textContent = 'Syncing...';
                    break;
                case 'offline':
                    dot.classList.add('offline');
                    text.textContent = 'Offline';
                    break;
            }
        }

        // ===========================================
        // FIREBASE FUNCTIONS
        // ===========================================

        function initFirebase() {
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();

                // Enable offline persistence
                db.enablePersistence({ synchronizeTabs: true })
                    .catch((err) => {
                        console.log('Persistence error:', err);
                    });

                return true;
            } catch (e) {
                console.error('Firebase init error:', e);
                return false;
            }
        }

        async function saveToFirebase() {
            if (!db || !currentPlayer) return;

            updateSyncStatus('syncing');

            try {
                await db.collection('players').doc(currentPlayer.toLowerCase()).set({
                    name: currentPlayer,
                    completedSquares: Array.from(completedSquares),
                    completedCount: completedSquares.size,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });

                updateSyncStatus('synced');
                return true;
            } catch (e) {
                console.error('Firebase save error:', e);
                updateSyncStatus('offline');
                return false;
            }
        }

        async function loadFromFirebase() {
            if (!db || !currentPlayer) return null;

            try {
                const doc = await db.collection('players').doc(currentPlayer.toLowerCase()).get();
                if (doc.exists) {
                    return doc.data();
                }
                return null;
            } catch (e) {
                console.error('Firebase load error:', e);
                return null;
            }
        }

        function subscribeToLeaderboard() {
            if (!db) return;

            if (leaderboardUnsubscribe) {
                leaderboardUnsubscribe();
            }

            leaderboardUnsubscribe = db.collection('players')
                .orderBy('completedCount', 'desc')
                .limit(50)
                .onSnapshot((snapshot) => {
                    const players = [];
                    snapshot.forEach((doc) => {
                        players.push(doc.data());
                    });
                    renderLeaderboard(players);
                }, (error) => {
                    console.error('Leaderboard error:', error);
                });
        }

        // ===========================================
        // UI RENDERING
        // ===========================================

        function renderBingoGrid() {
            const grid = document.getElementById('bingoGrid');
            grid.innerHTML = '';

            playerCard.forEach((square, index) => {
                const cell = document.createElement('div');
                cell.className = 'bingo-cell';
                if (completedSquares.has(index)) {
                    cell.classList.add('completed');
                }

                cell.innerHTML = `<span class="cell-text">${square.text}</span>`;
                cell.addEventListener('click', () => openCellModal(index));

                grid.appendChild(cell);
            });
        }

        function updateProgress() {
            const count = completedSquares.size;
            const total = 25;
            const percent = (count / total) * 100;

            document.getElementById('progressCount').textContent = `${count}/${total}`;
            document.getElementById('progressFill').style.width = `${percent}%`;
            document.getElementById('playerScoreText').textContent = `${count}/${total} completed`;

            // Check for bingo
            if (count === total) {
                showBingoCelebration();
            }
        }

        function renderLeaderboard(players) {
            const list = document.getElementById('leaderboardList');

            if (players.length === 0) {
                list.innerHTML = `
                    <div class="leaderboard-empty">
                        <div class="leaderboard-empty-emoji">üé≠</div>
                        <p>No players yet. Be the first!</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = players.map((player, index) => {
                const rank = index + 1;
                let rankClass = '';
                if (rank === 1) rankClass = 'top-1';
                else if (rank === 2) rankClass = 'top-2';
                else if (rank === 3) rankClass = 'top-3';

                const isCurrentUser = player.name.toLowerCase() === currentPlayer?.toLowerCase();

                return `
                    <div class="leaderboard-item ${rankClass} ${isCurrentUser ? 'current-user' : ''}">
                        <div class="leaderboard-rank">${rank <= 3 ? ['ü•á', 'ü•à', 'ü•â'][rank-1] : rank}</div>
                        <div class="leaderboard-player">
                            <div class="leaderboard-player-name">${player.name} ${isCurrentUser ? '(You)' : ''}</div>
                            <div class="leaderboard-player-progress">${player.completedCount}/25 squares</div>
                        </div>
                        <div class="leaderboard-score">${player.completedCount}</div>
                    </div>
                `;
            }).join('');
        }

        // ===========================================
        // MODAL FUNCTIONS
        // ===========================================

        function openCellModal(index) {
            selectedCellIndex = index;
            const square = playerCard[index];
            const isCompleted = completedSquares.has(index);

            document.getElementById('modalEmoji').textContent = square.emoji;
            document.getElementById('modalTitle').textContent = square.text;

            const statusEl = document.getElementById('modalStatus');
            const confirmBtn = document.getElementById('modalConfirm');

            if (isCompleted) {
                statusEl.textContent = '‚úì Completed!';
                statusEl.className = 'modal-status done';
                confirmBtn.textContent = 'Undo';
                confirmBtn.className = 'modal-btn modal-btn-undo';
            } else {
                statusEl.textContent = 'Not completed yet';
                statusEl.className = 'modal-status pending';
                confirmBtn.textContent = 'Mark Done! ‚úì';
                confirmBtn.className = 'modal-btn modal-btn-confirm';
            }

            document.getElementById('cellModal').classList.add('active');
        }

        function closeCellModal() {
            document.getElementById('cellModal').classList.remove('active');
            selectedCellIndex = null;
        }

        async function toggleCellCompletion() {
            if (selectedCellIndex === null) return;

            const wasCompleted = completedSquares.has(selectedCellIndex);

            if (wasCompleted) {
                completedSquares.delete(selectedCellIndex);
                showToast('Square unmarked', 'info');
            } else {
                completedSquares.add(selectedCellIndex);
                showToast('DALE! üáßüá∑', 'success');
                triggerConfetti();
            }

            // Update UI immediately
            renderBingoGrid();
            updateProgress();

            // Save to both local and Firebase
            saveToLocalStorage();
            await saveToFirebase();

            closeCellModal();
        }

        // ===========================================
        // CELEBRATION EFFECTS
        // ===========================================

        function triggerConfetti() {
            const container = document.getElementById('confettiContainer');
            container.style.display = 'block';

            const colors = ['#FACC15', '#EC4899', '#22C55E', '#9333EA', '#F97316', '#0EA5E9'];

            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                container.appendChild(confetti);
            }

            setTimeout(() => {
                container.innerHTML = '';
                container.style.display = 'none';
            }, 3500);
        }

        function showBingoCelebration() {
            document.getElementById('bingoCelebration').classList.add('active');
            triggerConfetti();
            triggerConfetti();
        }

        function closeBingoCelebration() {
            document.getElementById('bingoCelebration').classList.remove('active');
        }

        // ===========================================
        // BACKGROUND DECORATIONS
        // ===========================================

        function createBackgroundDecorations() {
            const container = document.getElementById('bgDecorations');

            // Brazilian-themed emojis
            const emojis = ['üé≠', 'üéâ', 'üéä', 'üíÉ', 'üï∫', 'üáßüá∑', 'üå¥', 'ü•Å', 'üé∫', 'ü™ò', '‚ú®', 'üçπ', 'üé™', 'ü¶ú', '‚öΩ', 'üèñÔ∏è', 'üåä', '‚òÄÔ∏è', 'ü••', 'üíö', 'üíõ'];

            // Brazilian memes and expressions
            const memes = [
                { text: 'VAI BRASIL! üáßüá∑', color: 'green' },
                { text: '√â N√ìIS!', color: 'yellow' },
                { text: 'BORA BORA!', color: 'pink' },
                { text: 'CARACA!', color: 'blue' },
                { text: 'DALE!', color: 'yellow' },
                { text: 'VAMOOO!', color: 'green' },
                { text: 'SAUDADE', color: 'pink' },
                { text: 'GOSTOSO!', color: 'yellow' },
                { text: 'MARAVILHA', color: 'green' },
                { text: '√â TETRA!', color: 'yellow' },
                { text: 'FICA FRIO', color: 'blue' },
                { text: 'TAMO JUNTO', color: 'green' },
                { text: 'BELEZA!', color: 'yellow' },
                { text: 'QUE ISSO!', color: 'pink' },
                { text: 'CAIPIRINHA üçπ', color: 'green' },
                { text: 'AX√â!', color: 'yellow' },
                { text: 'SAMBA! üíÉ', color: 'pink' },
                { text: 'MASSA!', color: 'blue' },
            ];

            // Add floating emojis
            for (let i = 0; i < 15; i++) {
                const emoji = document.createElement('div');
                emoji.className = 'floating-emoji';
                emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                emoji.style.left = Math.random() * 100 + '%';
                emoji.style.top = Math.random() * 100 + '%';
                emoji.style.animationDelay = Math.random() * 20 + 's';
                emoji.style.fontSize = (1.5 + Math.random() * 2) + 'rem';
                container.appendChild(emoji);
            }

            // Add meme stickers
            for (let i = 0; i < 8; i++) {
                const meme = memes[Math.floor(Math.random() * memes.length)];
                const sticker = document.createElement('div');
                sticker.className = `meme-sticker ${meme.color}`;
                sticker.textContent = meme.text;
                sticker.style.left = Math.random() * 80 + 10 + '%';
                sticker.style.top = Math.random() * 80 + 10 + '%';
                sticker.style.setProperty('--rotation', (Math.random() * 30 - 15) + 'deg');
                sticker.style.animationDelay = Math.random() * 25 + 's';
                sticker.style.fontSize = (0.7 + Math.random() * 0.5) + 'rem';
                container.appendChild(sticker);
            }
        }

        // ===========================================
        // EVENT HANDLERS
        // ===========================================

        function setupEventListeners() {
            // Login
            const nameInput = document.getElementById('playerNameInput');
            const joinBtn = document.getElementById('joinBtn');

            nameInput.addEventListener('input', (e) => {
                joinBtn.disabled = e.target.value.trim().length < 2;
            });

            nameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !joinBtn.disabled) {
                    handleJoin();
                }
            });

            joinBtn.addEventListener('click', handleJoin);

            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    const tabName = tab.dataset.tab;
                    document.getElementById('bingoTab').style.display = tabName === 'bingo' ? 'block' : 'none';
                    document.getElementById('leaderboardTab').style.display = tabName === 'leaderboard' ? 'block' : 'none';
                });
            });

            // Modal
            document.getElementById('modalCancel').addEventListener('click', closeCellModal);
            document.getElementById('modalConfirm').addEventListener('click', toggleCellCompletion);
            document.getElementById('cellModal').addEventListener('click', (e) => {
                if (e.target.id === 'cellModal') closeCellModal();
            });

            // Bingo celebration
            document.getElementById('bingoClose').addEventListener('click', closeBingoCelebration);

            // Online/offline detection
            window.addEventListener('online', handleOnline);
            window.addEventListener('offline', handleOffline);
        }

        async function handleJoin() {
            const name = document.getElementById('playerNameInput').value.trim();
            if (name.length < 2) return;

            currentPlayer = name;
            playerCard = generateCard(name);

            // Show game screen
            document.getElementById('loginScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');

            // Update player info
            document.getElementById('playerDisplayName').textContent = name;
            document.getElementById('playerAvatar').textContent = ['üé≠', 'üíÉ', 'üï∫', 'üéâ', 'üåü'][Math.floor(Math.random() * 5)];

            // Try to load existing progress
            const firebaseData = await loadFromFirebase();
            const localData = loadFromLocalStorage();

            // Merge data - prefer Firebase, fallback to local
            if (firebaseData && firebaseData.completedSquares) {
                completedSquares = new Set(firebaseData.completedSquares);
            } else if (localData && localData.playerName === currentPlayer && localData.completedSquares) {
                completedSquares = new Set(localData.completedSquares);
                // Sync local data to Firebase
                await saveToFirebase();
            }

            // Save to local storage
            saveToLocalStorage();

            // Render UI
            renderBingoGrid();
            updateProgress();

            // Subscribe to leaderboard
            subscribeToLeaderboard();

            showToast(`E a√≠ ${name}! BORA! üáßüá∑`, 'success');
        }

        function handleOnline() {
            isOnline = true;
            document.getElementById('offlineBanner').classList.remove('active');
            updateSyncStatus('syncing');

            // Sync any pending changes
            saveToFirebase().then(() => {
                showToast('Voltou! Synced ‚úì üçπ', 'success');
            });
        }

        function handleOffline() {
            isOnline = false;
            document.getElementById('offlineBanner').classList.add('active');
            updateSyncStatus('offline');
        }

        // ===========================================
        // INITIALIZATION
        // ===========================================

        function init() {
            // Create background decorations
            createBackgroundDecorations();

            // Setup event listeners
            setupEventListeners();

            // Initialize Firebase
            const firebaseReady = initFirebase();

            if (!firebaseReady) {
                showToast('Running in offline mode', 'info');
                updateSyncStatus('offline');
            }

            // Check for existing session
            const localData = loadFromLocalStorage();
            if (localData && localData.playerName) {
                // Auto-login
                document.getElementById('playerNameInput').value = localData.playerName;
                document.getElementById('joinBtn').disabled = false;
            }

            // Set initial online status
            if (!navigator.onLine) {
                handleOffline();
            }
        }

        // Start the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
